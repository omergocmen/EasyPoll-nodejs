<%- include('./partials/navbar.ejs') %>


<% if (locals.message !="") { %>
  <div class="alert alert-<%- locals.message[0].split(":")[0] %> alert-dismissible fade show" role="alert" style="text-align: center;">
      <b><%- locals.message[0].split(":")[1] %></b>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
<% } %>  


<div class="dateSection shadow" style="width:100%;max-width:960px; height:900px;min-height:500px;margin:auto;margin-top: 150px;margin-bottom: 70px;">
<br>
<div class="mdl-card mdl-shadow--2dp">
    <div class="mdl-card__supporting-text">
        <div class="mdl-stepper-horizontal-alternative">
            <div class="mdl-stepper-step step-done">
                <div class="mdl-stepper-circle"><span>1</span></div>
                <div class="mdl-stepper-title">Etkinlik Oluştur</div>
                <div class="mdl-stepper-bar-left"></div>
                <div class="mdl-stepper-bar-right"></div>
            </div>
            <div class="mdl-stepper-step step-done">
                <div class="mdl-stepper-circle"><span>2</span></div>
                <div class="mdl-stepper-title">Tarih-Saat Seçimi</div>
                <div class="mdl-stepper-bar-left"></div>
                <div class="mdl-stepper-bar-right"></div>
            </div>
            <div class="mdl-stepper-step active-step">
                <div class="mdl-stepper-circle"><span>3</span></div>
                <div class="mdl-stepper-title">Oylama</div>
                <div class="mdl-stepper-bar-left"></div>
                <div class="mdl-stepper-bar-right"></div>
            </div>
        </div>
    </div>
</div>


<section class="tablee" style="width: 60%; min-height: 50px;  max-height: 500px;  margin: 20px auto;">
<div class="">
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h5 class="modal-title" id="exampleModalLabel"><%- poll.title.toUpperCase("tr") %> Anketini silmek istiyor musunuz ?</h5>
      </div>
      <div class="modal-footer">
        <a class="btn btn-danger" href="http://localhost:3000/home/createPoll/delete/<%- dates[0].pollId %>">Sil</a>
      </div>
    </div>
  </div>
</div>
</div>  
  
  <form method="post">
      <div class="inSection" style="text-align: center;">
        <br>
        <h3><%- poll.title.toUpperCase("tr") %> </h3>
        <h6><%- poll.description %> </h6>
      </div>
 
</section>
<section class="tablee" style="width: 70%; min-height: 300px; max-height: 500px; overflow: auto; margin: 50px auto;">
   
    <table class="table">

        <thead>
          <tr>
            <% dates.forEach(element => { %>
                <th scope="col"><%- element.date %>  <p><b style="font-size: 10px;"><%- element.beginTime %> </b>:<b style="font-size: 10px;"><%- element.endTime %> </b></p> </th>
            <% }) %>
            <th>Düzenle</th>
            <th>Oy Kullanan</th>
            <th>
              <div class="dropdown">
                
                <% if (manager==true) { %>
                  <a class="btn btn-secondary dropdown-toggle" style="border-radius: 10px;" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-ellipsis-h"></i>
                  </a>
                  <% } %>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">

                  <li><a class="dropdown-item" href="http://localhost:3000/home/createPoll/edit/<%- dates[0].pollId %>">Anket bilgileri Güncelle</a></li>
                  <li><a class="dropdown-item" href="http://localhost:3000/home/createPoll/<%- dates[0].pollId %>">Takvim bilgileri Güncelle</a></li>
                  
                  <% if(poll.mode=="true"){ %>
                    <li><a class="dropdown-item" href="http://localhost:3000/home/createPoll/date/<%- dates[0].pollId %>?mode=false">Sonuçları Gizle</a></li>
                    <% } else if(poll.mode=="false") { %>
                      <li><a class="dropdown-item" href="http://localhost:3000/home/createPoll/date/<%- dates[0].pollId %>?mode=true">Herkese Açık</a></li>
                    <% } %>
                  <li><a class="dropdown-item" type="button"  data-bs-toggle="modal" data-bs-target="#exampleModal">
                    Anketi sil
                  </a></li>
                </ul>
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <form method="post">
            <% votes.forEach(voteElement => { %>
              <tr class="tr">
                    <% dates.forEach(dateElement => { %>
                      <% if(voteElement.dates.includes(dateElement._id)){ %>
                        <td><i class="fas fa-check"></i></td>
                      <% } else{ %>  
                        <td><i class="fas fa-times"></i></td>
                     <% } %>
                  <% }) %>
                  <td><i  class="fas fa-pencil-alt pencil"></i></td>
                  <td><%- voteElement.voterFirstName %> <%- voteElement.voterLastName %> </td> 
              </tr>
            <% }) %>
            <tr class="oyla">
            <% dates.forEach(dateElement => { %>
              <td><input name="votes" value=<%- dateElement._id %>  class="form-check-input" type="checkbox"  id="flexCheckDefault"></td>
            <% }) %>
            <th></th>
            <th><button type="submit"  class="btn btn-success">Oyla</button></th>
          </tr>
          <tr>
            <% dates.forEach(dateElement => { %>
              <td><i style="font-size: 10px;" class="fas fa-check"></i><%- dateElement.totel %> </td>
            <% }) %>
          </tr>
        </tbody>
      </form>
      </table>
    
</section> <br>
</div>





<% if (manager==true) { %>


<div class="dateSection shadow" style="width:100%;max-width:1024px; height:auto;min-height:500px;margin:auto;margin-top: 150px;margin-bottom: 70px;">
    <br>

    <!-- Buranın altı tamamen yorumlar kısmı -->
    <div class="comments" style="width: 70%; margin:25px auto;">
      <% let index=0 %> 
      <% comments.forEach(element => { %>
        <% index=index+1 %> 
        
        <div class="card text-white bg-secondary mb-3" style="width: 100%;">
          <div class="card-header"><%- element.ownerName %>  <a style="float: right;" class="btn btn-danger" href="http://localhost:3000/home/createPoll/deleteMessage/<%- element._id %>">X</a>                    </div>
          <div class="card-body">
            <h5 class="card-title"><%- element.text %></h5>
            <p class="card-text"><%- element.createdAt.toLocaleDateString("tr", { day: 'numeric', month: 'numeric', year: 'numeric', weekday: 'long' }) %></p>            
            
            <% element.replies.forEach(e => { %>
              <div class="repliess" style="width: 75%; float: right;">
                <div class="card-header"><%- e.ownerName %> </div>
                <div class="card-body">
                  <h5 class="card-title"><%- e.text %></h5>
                  <p class="card-text"><%- e.createdAt.toLocaleDateString("tr", { day: 'numeric', month: 'numeric', year: 'numeric', weekday: 'long' }) %></p>
                </div>
              </div>
              <% }) %>


          </div>


            <div class="accordion" id="accordionExample">
              <div class="accordion-item" style="background-color: #6C757D;">
                <h2 class="accordion-header" id="headingTwo">
                  <button class="btn btn-success collapsed" style="width: auto; margin: 5px;" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo<%- index%>" aria-expanded="true" aria-controls="collapseOne">
                    Yanıtla
                    </button>
                </h2>
                <div id="collapseTwo<%- index%>" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                  <div class="accordion-body">
                  
                    <form method="post">
                      <input type="text" style="visibility: hidden;" readonly name="comment" value="<%- element.id %> " id="">
                      <textarea class="form-control mb-3 control" required name="comment" placeholder="Yorumlarınız Yazınız." id="floatingTextarea2" style="height: 100px"></textarea>
                      <button class="btn btn-success commentbtn"  type="submit">Yorum Yap</button>
                    </form>

                  </div>
                </div>
              </div>
            </div>
            
        </div>
      <% }) %>

      <form method="post">
        <input type="text" style="visibility: hidden;" readonly name="comment" value="comment" id="">
        <textarea class="form-control mb-3 control" required name="comment" placeholder="Yorumlarınız Yazınız." id="floatingTextarea2" style="height: 100px"></textarea>
        <button class="btn btn-success commentbtn"  type="submit">Yorum Yap</button>
      
      </form>
    </div>

     <!-- Buranın üstü tamamen yorumlar kısmı -->
    <br>
</div>



  <div class="dateSection shadow" style="width:100%;max-width:1024px; height:auto;min-height:500px;margin:auto;margin-top: 150px;margin-bottom: 70px;">
    <br>
    <div class="intro">
        <h2 class="text-center">Katılımcılara Email Gönder</h2>
        <p class="text-center">Ankete Katılmasını istediğin kullanıcılara Email gönder!</p>
    </div>
  
  
  
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="card card-white">
                    <div class="card-body">
                        <form action="javascript:void(0);">
                            <input type="email" class="form-control add-task" placeholder="Email">
                        </form>
                      <form method="post">
                        <div class="todo-list">
                            <div class="todo-item">
                              <input type="text" style="visibility: hidden;" readonly name="mail" value="email" id="">
                                <a href="javascript:void(0);" class="float-right remove-todo-item"><i class="icon-close"></i></a>
                            </div>
                        </div>
                        <button class="btn btn-success" type="submit">Gönder</button>
                      </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br>
    <br>
  </div>


<% } %>





<%- include('./partials/footer.ejs') %>